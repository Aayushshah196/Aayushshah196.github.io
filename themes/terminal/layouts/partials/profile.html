{{- $profile := false -}}
{{- $autoProfile := default $.Site.Params.autoProfile false }}

{{- if index .Params "profile" -}}
  {{- if .Resources.GetMatch .Params.Profile }}
    {{- $profile = (.Resources.GetMatch .Params.Profile).RelPermalink -}}
  {{- else -}}
    {{- $profile = absURL .Params.Profile -}}
  {{- end -}}
{{- else if $.Site.Params.AutoProfile -}}
  {{- if (not .Params.Profile) -}}
    {{- if .Resources.GetMatch "profile.*" -}}
      {{- $profile = (.Resources.GetMatch "profile.*").RelPermalink -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{if $profile -}}
  <!-- Profile image found -->
  <img style="margin: 0 auto; width: 100%; height: 100%;" src="{{ $profile }}"
    class="profile"
    alt="{{ .Title | plainify | default " " }}"
    height="{{ $.Site.Params.ProfileHeight | default "200" }}"
    title="{{ .Params.ProfileCredit |plainify|default "Profile Image" }}" />
{{- end }}